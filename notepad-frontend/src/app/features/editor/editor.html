<form [formGroup]="notaForm" (ngSubmit)="onSubmit()" class="editor-form">
  <h2>{{ note ? 'Editar Nota' : 'Criar Nova Nota' }}</h2>

  <!-- 1. Título -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Título</mat-label>
    <input matInput formControlName="titulo" placeholder="Título da Nota">
    <mat-error *ngIf="notaForm.get('titulo')?.hasError('required')">Título é obrigatório</mat-error>
  </mat-form-field>

  <!-- 2. Associação de Pasta -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Pasta</mat-label>
    <mat-select formControlName="pastaId">
      <mat-option *ngFor="let pasta of pastas" [value]="pasta.id">
        {{ pasta.nome }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="notaForm.get('pastaId')?.hasError('required')">Pasta é obrigatória</mat-error>
  </mat-form-field>

  <!-- 3. Associação de Tags (mat-chip-grid) -->
  <div class="tags-section">
    <mat-label>Tags Selecionadas:</mat-label>
    <mat-chip-grid #chipGrid aria-label="Seleção de Tags">
      <mat-chip-row *ngFor="let tag of tagsSelecionadas" (removed)="removeTag(tag)">
        {{ tag.nome }}
        <button matChipRemove [attr.aria-label]="'remover ' + tag.nome">
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
    </mat-chip-grid>
    
    <!-- Seletor para adicionar Tags -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Adicionar Tag</mat-label>
      <mat-select #tagSelect (selectionChange)="addTag($event.value); tagSelect.value = null">
        <mat-option *ngFor="let tag of tagsDisponiveis" [value]="tag">
          {{ tag.nome }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- 4. Conteúdo (ngx-quill) -->
  <mat-label>Conteúdo da Nota</mat-label>
  <quill-editor formControlName="conteudo" [styles]="{height: '300px'}" class="quill-editor"></quill-editor>
  <mat-error *ngIf="notaForm.get('conteudo')?.hasError('required')">Conteúdo é obrigatório</mat-error>

  <!-- Botão de Submissão -->
  <button mat-raised-button color="primary" type="submit" [disabled]="notaForm.invalid">
    Salvar Nota
  </button>
</form>