<mat-nav-list>
  <!-- Filtro Padrão: Todas as notas -->
  <mat-list-item (click)="selectFilter('all', null)">
    Todas as Notas
  </mat-list-item>
</mat-nav-list>

<mat-accordion class="sidebar-accordion">

  <!-- Painel de Pastas -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>Pastas ({{ pastas.length }})</mat-panel-title>
      <!-- Botão de Criação de Pastas -->
      <button mat-icon-button
              matTooltip="Criar pasta"
              (click)="toggleNewPastaForm($event)">
        <mat-icon>add</mat-icon>
      </button>
    </mat-expansion-panel-header>

    <!-- Formulário de Criação -->
    <div *ngIf="isCreatingPasta" class="creation-form" (click)="$event.stopPropagation()">
      <mat-form-field appearance="outline">
        <input 
          matInput 
          [formControl]="newPastaName" 
          placeholder="Nome da pasta"
          (click)="$event.stopPropagation()"
          (keydown)="$event.stopPropagation()"
        >
        <mat-error *ngIf="newPastaName.invalid">Nome é obrigatório</mat-error>
      </mat-form-field>
      <button mat-button color="primary" (click)="criarPasta()" [disabled]="newPastaName.invalid">
        Criar
      </button>
    </div>

    <mat-nav-list>
      <mat-list-item
        *ngFor="let pasta of pastas"
        (click)="selectFilter('pasta', pasta.id)">

        <ng-container *ngIf="isEditingPasta === pasta.id; else displayPasta">
          <mat-form-field appearance="fill" class="edit-input">
            <input 
              matInput 
              [formControl]="editPastaName" 
              (keydown.enter)="atualizarPasta(pasta.id)"
              (click)="$event.stopPropagation()"
            >
          </mat-form-field>

          <button mat-icon-button color="primary" [disabled]="editPastaName.invalid" (click)="atualizarPasta(pasta.id); $event.stopPropagation()">
            <mat-icon>check</mat-icon>
          </button>

          <button mat-icon-button (click)="cancelarEdicaoPasta(); $event.stopPropagation()">
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>

        <ng-template #displayPasta>
          <mat-icon matListIcon>folder</mat-icon>
          <span>{{ pasta.nome }}</span>

          <button mat-icon-button [matMenuTriggerFor]="pastaMenu" (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #pastaMenu="matMenu">
            <button mat-menu-item (click)="iniciarEdicaoPasta(pasta)">
              <mat-icon>edit</mat-icon>
              <span>Editar</span>
            </button>
            <button mat-menu-item (click)="deletarPasta(pasta.id)">
              <mat-icon>delete</mat-icon>
              <span>Excluir</span>
            </button>
          </mat-menu>
        </ng-template>
      </mat-list-item>

      <mat-list-item *ngIf="pastas.length === 0">
        <span class="no-item">Nenhuma pasta criada</span>
      </mat-list-item>
    </mat-nav-list>
  </mat-expansion-panel>

  <!-- Painel de Tags -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>Tags ({{ tags.length }})</mat-panel-title>
      <button mat-icon-button 
              matTooltip="Criar tag"
              (click)="toggleNewTagForm($event)">
        <mat-icon>add</mat-icon>
      </button>
    </mat-expansion-panel-header>
    
    <!-- Formulário de Criação -->
    <div *ngIf="isCreatingTag" class="creation-form" (click)="$event.stopPropagation()">
      <mat-form-field appearance="outline">
        <input 
          matInput 
          [formControl]="newTagName" 
          placeholder="Nome da Tag"
          (click)="$event.stopPropagation()"
          (keydown)="$event.stopPropagation()"
        >
        <mat-error *ngIf="newTagName.invalid">Nome é obrigatório.</mat-error>
      </mat-form-field>
      <button mat-button color="primary" (click)="criarTag()" [disabled]="newTagName.invalid">
        Criar
      </button>
    </div>
    
    <mat-nav-list>
      <mat-list-item
        *ngFor="let tag of tags"
        (click)="selectFilter('tag', tag.id)">
        
        <ng-container *ngIf="isEditingTag === tag.id; else displayTag">
          <mat-form-field appearance="fill" class="edit-input">
            <input 
              matInput 
              [formControl]="editTagName" 
              (keydown.enter)="atualizarTag(tag.id)"
              (click)="$event.stopPropagation()"
            >
          </mat-form-field>
        
          <button mat-icon-button color="primary" [disabled]="editTagName.invalid" (click)="atualizarTag(tag.id); $event.stopPropagation()">
            <mat-icon>check</mat-icon>
          </button>
          
          <button mat-icon-button (click)="cancelarEdicaoTag(); $event.stopPropagation()">
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>

        <ng-template #displayTag>
          <mat-icon matListItemIcon>label</mat-icon>
          <span>{{ tag.nome }}</span>
          
          <button mat-icon-button [matMenuTriggerFor]="tagMenu" (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #tagMenu="matMenu">
            <button mat-menu-item (click)="iniciarEdicaoTag(tag)">
              <mat-icon>edit</mat-icon>
              <span>Editar</span>
            </button>
            <button mat-menu-item (click)="deletarTag(tag.id)">
              <mat-icon>delete</mat-icon>
              <span>Excluir</span>
            </button>
          </mat-menu>
        </ng-template>
      </mat-list-item>

      <mat-list-item *ngIf="tags.length === 0">
        <span class="no-items">Nenhuma tag criada.</span>
      </mat-list-item>
    </mat-nav-list>
  </mat-expansion-panel>

</mat-accordion>
